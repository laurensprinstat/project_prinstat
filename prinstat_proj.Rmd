---
title: "Randomized blood pressure reduction trial"
author: Robin Boudry, Maarten Rahier, Tom Schipper, Laurens Van Paemel
output:
  word_document:
    highlight: "tango"
    toc: yes
    toc_depth: 1
---

```{r}
library(ggplot2)
library(plyr)
library(Hmisc)
library(psych)
library(dplyr)
library(expss)
library(qwraps2)
## Stargazer
options(qwraps2_markup = "markdown")
```

```{r}
# Read in data
data <- read.table("bptrial.txt", header=TRUE, sep=",", dec=".")

# Set column names
colnames(data) <- c("treatment", "sex", "weight", "age", "dose", "dbpdif", "dbp3", "dbp2", "dbp1")

# Add column dbp5 (measurement at the end of the experiment)
data$dbp_end <- data$dbp3 + data$dbpdif

# Mean dbp during the run-off period
data$dbp_mean <- round((data$dbp1 + data$dbp2 + data$dbp3) / 3, 1)

# Treatment group as factor
data$treatment <- as.factor(data$treatment)

# Gender as factor
data$sex <- as.factor(mapvalues(data$sex, from=c(0, 1), to=c("female", "male")))
```

# Question 1

1. a) Check for any errors (obviously suspicious observations due to data entry errors, should be corrected if possible). Clarify in your report what mistakes you have detected, and how you detected them. All further questions below should be answered based on the cleaned data.

The active dose, denoting the amount of pills taken a day is given for each group. However, the data suggests that a number of patients didn't take the prescribed pills for extended periods of time. Before removing observations of patients who didn't follow the prescribed treatment plan, the relation between the active dose and weight, age and dbp is examined to explore whether the dosage assigned to each patient might vary according to one of these variables. There's a weak positive linear relationship between mean dbp measure during the run-off period and the dosage in the first experimental group (correlation coefficient of 0.28), which suggests higher dosages might have been prescribed based on the bloodpressure. However, the total dosage taken during the span of the experiment is consistently a whole number, suggesting that each pill was equally dosed and that some patients simply popped a pill extra or less on a few occasions. It is unknown whether patients were told not to take a pill when their dbp was low or an extra pill when it was very high. Based on this, any patients whose total dosage during the experiment was lower than 80% of the prescribed dosage have been removed.

## Cleaning

```{r}
# Missing value count
colSums(is.na(data))
```


## Dosage
-> remove observations with a dosage below 0.8

```{r}
summary(data$dose)

# Dose by treatment group
boxplot(data$dose~data$treatment, data=data, main="Dose by treatment group", xlab="Treatment group", ylab="Dose")

# Patients who didn't take pills at least 60% of the experimental days
data <- data[order(data$dose),]
data_low_dose <- data[data$dose < 0.6,]
data_low_dose

# Remove observations of patients who didn't take the prescribed medication for more than 40% of all experiment days.
data <- data[data$dose >= 0.6,]

# Split treatment groups
treat1 <- data[data$treatment == 1,]
placebo <- data[data$treatment == 2,]
treat3 <- data[data$treatment == 3,]
```

#(RB) use of corrplot for more lenient code and report?
#library(corrplot); corrplot(data, method = "circle")
```{r}
# Correlation coefficient all
cor(data$weight, data$dose)
cor(data$weight, data$dbp_mean)
cor(data$weight, data$age)

# Correlation by treatment group - weight
cor(treat1$weight, treat1$dose)
cor(placebo$weight, placebo$dose)
cor(treat3$weight, treat3$dose)

# Correlation by treatment group - age
cor(treat1$age, treat1$dose)
cor(placebo$age, placebo$dose)
cor(treat3$age, treat3$dose)

# Correlation by treatment group - dbp mean
cor(treat1$dbp_mean, treat1$dose)
cor(placebo$dbp_mean, placebo$dose)
cor(treat3$dbp_mean, treat3$dose)
```

```{r}
# Scatterplot
plot(treat1$dbp_mean, treat1$dose)
# Regression line
abline(lm(treat1$dose~treat1$dbp_mean), col="red")
```

```{r}
treat1$total_dose <- treat1$dose * 28
treat1$total_dose
```
#(RB) why only group 1? not sure what you are doing here, please explain

#(RB) double line 71:77, remove?
```{r}
# Remove observations of patients who didn't take the prescribed treatment at least 80 % of the time
data <- data[data$dose >= 0.8,]
# Mention the bias that arises from the removal of observations

# Split treatment groups
treat1 <- data[data$treatment == 1,]
placebo <- data[data$treatment == 2,]
treat3 <- data[data$treatment == 3,]
```
#(RB) not sure about choosing 80%, seems arbitrary. What about +120% ?. Please consider the outlier procedure I included below
##
start
##
'1.2. Check for outliers based on quantiles and IQR (upper & lower)'

#outlier check function
statoutliers <- function(variable){
Q1_dose<-quantile(
  variable,0.25,names=FALSE)
Q3_dose<-quantile(
  variable,0.75,names=FALSE)

IQR<-IQR(variable)
lower_limit<-Q1_dose-1.5*IQR
upper_limit<-Q3_dose+1.5*IQR

print(paste('IQR is', IQR))
print(paste('lower limit is',lower_limit))
print(paste('upper limit is',upper_limit))

number_lower_outliers<-sum(
  variable < lower_limit)
number_upper_outliers<-sum(
  variable> upper_limit)

print(paste('the number of lower outliers is', number_lower_outliers))
print(paste('the number of upper outliers is', number_upper_outliers))
}

statoutliers(data$dose)

#outlier remove function
rmstatoutliers<- function(variable, data){
  Q1_dose<-quantile(
  variable,0.25,names=FALSE)
Q3_dose<-quantile(
  variable,0.75,names=FALSE)
IQR<-IQR(variable)
lower_limit<-Q1_dose-1.5*IQR
upper_limit<-Q3_dose+1.5*IQR

return(data[variable>lower_limit & variable<upper_limit,])
}

#actual cleaning, 21+3 outliers
#data <- data[data$dose>lower_limit_dose & data$dose<upper_limit_dose,]
data <- rmstatoutliers(data$dose, data)
##
stop
##


## DBP run-in period
-> replace extreme observation of 66 by the mean of the other two measures

```{r}
# Diastolic bloodpressure below 90 during one of the measurements during the run-in period
data[data$dbp1 < 90 | data$dbp2 < 90 | data$dbp3 < 90,]
```

#(RB) 101 is correct but plz make sure it doesnt seem arbitrary
```{r}
# Replace extreme observation
data$dbp3[data$dbp3 == 66] <- 101
# Recalc the mean dbp
data$dbp_mean <- round((data$dbp1 + data$dbp2 + data$dbp3) / 3, 1)
```


```{r}
# Frequencies of measures
count(data$dbp1)
count(data$dbp2)
count(data$dbp3)
count(round(data$dbp_mean, 0))
histogram(round(data$dbp_mean, 0), breaks=seq(85,125,1))
```

1. (b) Describe the study population and hence the scope of the evaluation.

The study population consists of people who suffer from hypertension stage 2 (diastolic bloodpressure above 90). No other criteria seem to have been applied (age, weight, gender).

```{r}
# Add population describtives table
# Characteristics of the study population table
```


```{r}
boxplot(data$dbp_mean~data$treatment, data=data, main="DBP by treatment group", xlab="Treatment group", ylab="DBP")
```

1. (c) to help evaluate assumptions which facilitate subsequent analyses.

Are the groups comparable?
They seem to be quite comparable.

Normality?
DBP is skewed to the right
Because of the small sample size it's difficult to tell whether dbpdif is normally distributed or not

## Comparable groups?

```{r}
# Gender by treatment group
ggplot(data, aes(treatment, fill=sex)) +
  geom_bar(position="fill") +
  scale_y_continuous(labels = scales::percent, name ="Percentage") +
  ggtitle("Gender balance by treatment group")
```

```{r}
# Mean weight by treatment group
summary(data$weight~data$treatment)

# Weight by treatment group
boxplot(data$weight~data$treatment, data=data, main="Weight by treatment group", xlab="Treatment group", ylab="Weight")
```

```{r}
# Mean age by treatment group
summary(data$age~data$treatment)

# Age by treatment group
boxplot(data$age~data$treatment, data=data, main="Age by treatment group", xlab="Treatment group", ylab="Age")
```

```{r}
# Mean run-off DBP by treatment group
summary(data$dbp_mean~data$treatment)

# Age by treatment group
boxplot(data$dbp_mean~data$treatment, data=data, main="Age by treatment group", xlab="Treatment group", ylab="DBP mean")
```

## Normality?

```{r}
describe(data) 
```

```{r}
histogram(round(data$dose, 2), breaks=seq(0.8,1.40,0.05))
```

```{r}
histogram(round(data$dbp_mean, 2), breaks=seq(90,130,1))
```

```{r}
# Histograms of dbpdif per treatment group
par(mfrow=c(1,3))
histogram(treat1$dbpdif, breaks=seq(-35,5,5))
histogram(placebo$dbpdif, breaks=seq(-25,25,5))
histogram(treat3$dbpdif, breaks=seq(-45,10,5))
par(mfrow=c(1,1))
```

# Question 2
#(RB) please consider making a selection of what we will actually use

```{r}
describeBy(data %>% select(dbp_mean, dbp1, dbp2, dbp3, dbp_end, dbpdif), group=data$treatment)
```

```{r}
# Summary stats using the expss package (not very good)
data %>% 
  tab_cells(dbp_mean, dbp_end, dbpdif) %>%
  tab_cols(total(label="Total"), treatment) %>%
  tab_stat_fun(Mean = w_mean, "Std. dev." = w_sd, method = list) %>%
  tab_last_sig_means(subtable_marks = "both") %>%
  tab_pivot() %>% 
  htmlTable(caption = "Table with summary statistics and significance marks.")
```

```{r}
# Custom summary table using dplyr (use this one) - format 1
summarycols <-
  list(
    "Run-in mean DBP" =
      list(
        "mean (sd)" = ~ qwraps2::mean_sd(dbp_mean),
        "min" = ~ min(dbp_mean),
        "25th" = ~ quantile(dbp_mean, .25),
        "Median" = ~ median(dbp_mean),
        "75th" = ~ quantile(dbp_mean, .75),
        "max" = ~ max(dbp_mean)
      ),
    "Final DBP" =
      list(
        "mean (sd)" = ~ qwraps2::mean_sd(dbp_end),
        "min" = ~ min(dbp_end),
        "25th" = ~ quantile(dbp_end, .25),
        "Median" = ~ median(dbp_end),
        "75th" = ~ quantile(dbp_end, .75),
        "max" = ~ max(dbp_end)
      ),
    "DBP change" =
      list(
        "mean (sd)" = ~ qwraps2::mean_sd(dbp_mean),
        "min" = ~ min(dbp_mean),
        "25th" = ~ quantile(dbp_mean, .25),
        "Median" = ~ median(dbp_mean),
        "75th" = ~ quantile(dbp_mean, .75),
        "max" = ~ max(dbp_mean)
      )
  )

print(summary_table(dplyr::group_by(data, treatment), summarycols),
      rtitle = "Summary Statistics",
      cnames = c("Treatment 1", "Placebo", "Treatment 3"))
```

```{r}
# Custom summary table using dplyr (use this one) - format 2
summarycols <-
  list(
    "treatment1" =
      list(
        "mean (sd)" = ~ qwraps2::mean_sd(treat1$dbp_mean),
        "min" = ~ min(treat1$dbp_mean),
        "25th" = ~ quantile(treat1$dbp_mean, .25),
        "Median" = ~ median(treat1$dbp_mean),
        "75th" = ~ quantile(treat1$dbp_mean, .75),
        "max" = ~ max(treat1$dbp_mean)
      ),
    "placebo" =
      list(
        "mean (sd)" = ~ qwraps2::mean_sd(placebo$dbp_mean),
        "min" = ~ min(placebo$dbp_mean),
        "25th" = ~ quantile(placebo$dbp_mean, .25),
        "Median" = ~ median(placebo$dbp_mean),
        "75th" = ~ quantile(placebo$dbp_mean, .75),
        "max" = ~ max(placebo$dbp_mean)
      ),
    "treatment3" =
      list(
        "mean (sd)" = ~ qwraps2::mean_sd(treat3$dbp_mean),
        "min" = ~ min(treat3$dbp_mean),
        "25th" = ~ quantile(treat3$dbp_mean, .25),
        "Median" = ~ median(treat3$dbp_mean),
        "75th" = ~ quantile(treat3$dbp_mean, .75),
        "max" = ~ max(treat3$dbp_mean)
      )
  )

summary_table(data, summarycols)
```

```{r}
library(reshape2)
# Columns to rows
data_pop <- melt(data, id.vars='treatment', measure.vars=c('dbp_mean', 'dbp_end', 'dbpdif'))
data_pop$ID <- seq.int(nrow(data))

# Custom summary table using dplyr (use this one) - format 3
summarycols <-
  list(
    "treatment1" =
      list(
        "mean (sd)" = ~ qwraps2::mean_sd(data_pop[data_pop$treatment == 1 & data_pop$variable == variable,]$value),
        "min" = ~ min(data_pop[data_pop$treatment == 1 & data_pop$variable == variable,]$value),
        "25th" = ~ quantile(data_pop[data_pop$treatment == 1 & data_pop$variable == variable,]$value, .25),
        "Median" = ~ median(data_pop[data_pop$treatment == 1 & data_pop$variable == variable,]$value),
        "75th" = ~ quantile(data_pop[data_pop$treatment == 1 & data_pop$variable == variable,]$value, .75),
        "max" = ~ max(data_pop[data_pop$treatment == 1 & data_pop$variable == variable,]$value)
      ),
    "placebo" =
      list(
        "mean (sd)" = ~ qwraps2::mean_sd(data_pop[data_pop$treatment == 2 & data_pop$variable == variable,]$value),
        "min" = ~ min(data_pop[data_pop$treatment == 2 & data_pop$variable == variable,]$value),
        "25th" = ~ quantile(data_pop[data_pop$treatment == 2 & data_pop$variable == variable,]$value, .25),
        "Median" = ~ median(data_pop[data_pop$treatment == 2 & data_pop$variable == variable,]$value),
        "75th" = ~ quantile(data_pop[data_pop$treatment == 2 & data_pop$variable == variable,]$value, .75),
        "max" = ~ max(data_pop[data_pop$treatment == 2 & data_pop$variable == variable,]$value)
      ),
    "treatment3" =
      list(
        "mean (sd)" = ~ qwraps2::mean_sd(data_pop[data_pop$treatment == 3 & data_pop$variable == variable,]$value),
        "min" = ~ min(data_pop[data_pop$treatment == 3 & data_pop$variable == variable,]$value),
        "25th" = ~ quantile(data_pop[data_pop$treatment == 3 & data_pop$variable == variable,]$value, .25),
        "Median" = ~ median(data_pop[data_pop$treatment == 3 & data_pop$variable == variable,]$value),
        "75th" = ~ quantile(data_pop[data_pop$treatment == 3 & data_pop$variable == variable,]$value, .75),
        "max" = ~ max(data_pop[data_pop$treatment == 3 & data_pop$variable == variable,]$value)
      )
  )

print(summary_table(dplyr::group_by(data_pop, variable), summarycols),
      rtitle = "Summary Statistics",
      cnames = c("dbp_mean", "dbp_end", "dbpdif"))
```

```{r}
data_pop
```

```{r}
data_pop[data_pop$treatment == 1,]$value
```


```{r}
ggplot(data, aes(x=dbp_end)) +
  geom_histogram() +
  facet_grid(~treatment) +
  stat_bin(binwidth=5)
```

```{r}
library(reshape2)
# Columns to rows
data_res <- melt(data, id.vars='treatment', measure.vars=c('dbp_mean','dbp_end'))
data_res$ID <- seq.int(nrow(data))

# Boxplots of placebo and treatment3 before and after the experiment
ggplot(data_res[data_res$treatment != 1,], aes(x=treatment, y=value, fill=variable)) +
  geom_boxplot()
```


```{r}
# Profile plot
ggplot(data_res[data_res$treatment != 1,], aes(x=variable, y=value, group=ID)) +
  geom_point() +
  geom_line()
```

## (RB) ## Question 2: descriptive analysis of the research question
Initial conclusion after
```{r}
#Research question: difference between treatment groups
#look at treatment groups

#final difference
#control around 0, other dropped by 10 median in final condition
#at start1, we can see at visit 1, little to no difference 
#upper range for control is somewhat larger  
summary(data)


#graph 
par(mfrow=c(1,4)) 
plot(data$treatment, data$dbp1,
     ylim=c(70, 130))  # we can see at visit 1, little to no difference
title('Dbp at Visit 1') 
plot(data$treatment, data$dbp2,
     ylim=c(70, 130)) #same trend visit 2
title('Dbp at Visit 2')
plot(data$treatment, data$dbp3,
     ylim=c(70, 130)) #same trend visit 3
title('Dbp at Visit 3')
plot(data$treatment, data$dbp5,
     ylim=c(70, 130)) #same trend visit 3
title('Dbp at Visit 5')
par(mfrow=c(1,1)) 

```
Conclusion q2: At first glance we can see that the groups had a similar bp at intake visits, but the treatment groups(1,3)
had a lower bp than before at the final visit. The control group(2) remained more or less stable throughout the study. 
We can see this as a first indication that the treatment groups did achieve a lower bp.


# Question 3

## Assuming normality
Welch Two Sample t-test
H0: The difference in diastolic blood pressure is equal in both the third treatment group and the placebo group.
Ho: mean(third treatment) - mean(placebo) = diff = 0
Ha: The difference in dialostic blood pressure is bigger in the third treatment group compared to the placebogroup.
Ha: mean(third treatment) - mean(placebo) = diff != 0

```{r}
mean(placebo$dbpdif)
mean(treat3$dbpdif)
boxplot(treat3$dbpdif,placebo$dbpdif)
t.test(treat3$dbpdif, placebo$dbpdif, mu=0, alternative = "two.sided", conf= 0.95, var.eq=F, paired=F)
```
Difference when treament 3 is used is bigger. The diastolic blood pressure decreases significantly more when using Treament 3.
Assumptions: 
scale of measurement, random sampling, normality of data distribution, adequacy of sample size -> Scale is not that large, not sure about normal distribution of both populations

## Not assuming normality 
Mann-Whitney U test (because we are not sure about the normal distribution of both populations)
Only one assumption, Samples are independent and randomly drawn
```{r}
wilcox.test(treat3$dbpdif, placebo$dbpdif, mu = 0, alt="two.sided", correct= TRUE, paired = FALSE, conf.int = TRUE, exact =FALSE)
```
Same conclusion. The diastolic blood pressure decreases significantly more when using Treament 3.
In this case I think it is best to use Mann-Whitney since we are not sure about the normal distribution.


## Question4
## Assuming normality
T-test
Power of the T-test for gender difference of >=4mmHg in the treatment effect
Here 2 sample T, comparing 2 group means to each other
```{r}
library(stats)

#male group
male <- data[data$sex == 'male',]
#female group
female <- data[data$sex == 'female',]

#get variables mean, sd, n,
m1 <- mean(male$dbp5)
m2 <- mean(female$dbp5)
sd1 <- sd(male$dbp5)
sd2 <- sd(female$dbp5)
num1 <- length(male$dbp5)
num2 <- length(female$dbp5)

n <- c(num1,num2)
mean <- c(m1,m2)
sd <- c(sd1,sd2)
df <- data.frame(n,mean,sd)

pooled_sd <- sqrt( sum(df$sd^2 * (df$n - 1)) / (sum(df$n - 1)) )

power.t.test(n=m1+m2, #size
             delta = 4, #effect size
             sd = pooled_sd, # use pooled sd cause comparing 2 groups
             sig.level = 0.05,
             type= "two.sample", #male & female
             alternative = 'two.sided' #detect a difference
             )
```
The power to detect a difference of 4hhMg at the 0.05 sign level between male and female using the T-test is 0.93


## Not assuming normality
Power here has to be calculated as a proportion, since we can not use the normal distribution to make inferences
Do the wilcox test for 1000 samples of random generated data with length, mean and sd as the male and female group to compare. See proportion of p-values smaller than 0.05
```{r}

pval <- replicate(1000, 
                  wilcox.test(rnorm(num1,m1,sd1), #male
                              rnorm(num2,m2,sd2), #female
                              mu=4)$p.value)      #mean difference to be detected
summary(pval) 
sum(pval < .05)/1000

```
The power decreases severely to 0.515 using this non parametric test

## Question5
Binary indicator of whether (dbp5-dbp3)<10mmHg between the 2 treatment arms.
Use appropriate 5% sign level & conclude, how and why do treatment arms differ?
How does this comparison differ from the one above?

## parametric
```{r}
#make binary variable
data23$binary <- 0
data23$binary[data23$dbpdif<10]<-1

binTr <-data23[data23$treatment == 'Treatment 3',]$binary
binPl <-data23[data23$treatment == 'Placebo',]$binary

#using a t-test
print(t.test(binary~treatment, 
             data = data23, 
             alternative = "less")
             )#since Placebo comes first in data23, x1 less x2


#function for calculatin the Z-statistic of 2 binary variables
#with x=succes(1) and n=total(number 0 & 1's)
z.prop = function(x1,x2,n1,n2){
  numerator = (x1/n1) - (x2/n2)
  p.common = (x1+x2) / (n1+n2)
  denominator = sqrt(p.common * (1-p.common) * (1/n1 + 1/n2))
  z.prop.ris = numerator / denominator
  return(z.prop.ris)
}

binTr <-data23[data23$treatment == 'Treatment 3',]$binary
binPl <-data23[data23$treatment == 'Placebo',]$binary
pasTr <- sum(binTr)
pasPl <- sum(binPl)
nTr <- length(passTr) 
nPl <- length(passPl)
z.prop(pasTr, pasPl, nTr, nPl)      #optional
```
From the 1 sample t-test using the binary indicating whether (dbp5-dbp3)<10mmHg, we can reject the H0 of different group means with a p-value of 0.025.
Computing a Z-score, we see it surpasses the 0.05 confidence value of 1.96

#non-parametric
use of prop.test from base R
H0: proportions in the groups are the same
```{r}
prop.test(c(pasTr,pasPl),
          c(nTr,nPl),
          alternative = 'greater' #has treatment 3 greater prop of 1's? (data23$dbpdif<10]<-1)
          )

#qchisq(0.9, 1)
```
We see that at the 0.05 accuracy rate we can't reject H0, but at the 0.06 rate we can. Although not overwhelming, we have some indication of Treatment 3 group measures being more below the 10 mmGh limit than placebo measures with this non-parametric test.

The treatments were compared here on a cut-off value of {dbp5-dbp3)<10mmHg}. Instead of comparing the natural group means, we created a yes or no indicator according to our set benchmark. The strength of this test will rely hugely on how well the cut-off value is chosen, and can not be seen as a complete representation of the difference between the groups. Only the difference in relation to the cut-off can be evalueted here.

## Question 6

expected evolution in blood pressure between visit 5 en 3 in the placebo group.

```{r}
mean(placebo$dbpdif)
hist(placebo$dbpdif)
```

Test if mean for Placebo group is different from 0. 
H0: mean difference for placebo group is equal to 0
H1: mean difference for placebo group is not equal to 0

## assuming normality
using one sample t-test
```{r}
t.test(placebo$dbpdif)
```

We do not reject the 0 hypothesis, so we expect no difference in bloodpressure between visit 5 an visit 3 in the placebo group. This shows that the effect of treat 1 and 3 can not be dedicated to a placebo effect.

## Not assuming normaility 
using one sample Wilcoxon test

```{r}
#Samples do not need to be drawn from a population with a normal distribution
qqnorm(placebo$dbpdif)
qqline(placebo$dbpdif)

wilcox.test(placebo$dbpdif, mu=0)
```
Same conclusion: H0 is not rejected, mean is not different from zero. No placebo effect.


## Question 7 

Does the mean difference in dbpdif between group 3 and group 2 depend on gender? Derive a justified answer.
2-way anova to see a possible interaction between treat and gender.

```{r}
library("car")
str(treat3)
```

```{r}
#Nieuw object maken dat enkel data van groepen 2 en 3 bevat
data23 <- data[which(data$treatment != "1"),]
data23$treatment <- droplevels(data23$treatment)
data23$treatment <- as.factor(data23$treatment)
```

## Visualization

```{r}
#(!require(devtools)) install.packages("devtools")
#devtools::install_github("kassambara/ggpubr")
str(data23)
library(ggpubr)
plot <- ggline(data23, x = "treatment", y = "dbpdif", color = "sex",
               add = c("mean_se", "dotplot"),
               palette = c("#00AFBB", "#E7B800"))
plot

```
Two-way ANOVA with interaction
Interaction = the effect of one factor on the dependent variable depends on the level of another factor
```{r}
model1 <- lm(dbpdif ~ sex * treatment, data = data23)
anova(model1)
#type 1 because we are interested in the interaction
```

There is no interaction, so the mean difference between group 3 and 2 does not depend on gender.

## Check assumptions of the model
```{r}
#Assumption 1 : Normal distribution of the model residuals
plot(model1,2)
```
Residuals approximatly normally distributed.

```{r}
#Assumption 2: Homogeneity of variance of the groups
plot(model1,1)
leveneTest(dbpdif ~ sex * treatment, data = data23)
```
P-value is larger than 0.05 so variances are approximatly equal.
Both assumptions are met.





















































